<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Boletim Diário • Monitoramento Poda e Remoção</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <!-- Seu CSS -->
  <link rel="stylesheet" href="css/style.css" />

  <!-- Chart.js (precisa vir ANTES do kpis-manual.js) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Seus scripts -->
  <script src="js/main.js" defer></script>
  <script src="js/kpis-manual.js" defer></script>
  <script src="js/planilha-modal.js" defer></script>

  <!-- Garantia de altura do canvas -->
  <style>
    .chart-wrap { height: 320px; }
    .chart-wrap canvas { width: 100% !important; height: 100% !important; }
  </style>
</head>

<body id="topo">

  <!-- TOP STRIP -->
  <div class="top-strip">
    <div class="container d-flex align-items-center justify-content-between gap-3 flex-wrap py-2">
      <div class="strip-left">
        <span class="strip-pill">COPLAN/Dados</span>
        <span class="strip-muted">Secretaria Municipal das Subprefeituras</span>
      </div>

      <div class="strip-right">
        <span class="strip-date">
          <i class="fa-regular fa-calendar me-2"></i><strong id="dataAtual">—</strong>
          <span class="mx-2">•</span>
          <i class="fa-regular fa-clock me-2"></i><strong id="horaAtual">—</strong>
        </span>

        <button class="btn btn-sm btn-outline-dark ms-2" onclick="window.print()">
          <i class="fa-solid fa-print me-2"></i>Imprimir
        </button>

        <a class="btn btn-sm btn-outline-dark" href="graficos_referencia.html">
          <i class="fa-solid fa-chart-column me-2"></i>Ver. Estoque referência
        </a>
      </div>
    </div>
  </div>

  <!-- MASTHEAD -->
  <header class="masthead">
    <div class="container py-3">
      <div class="masthead-grid">
        <div class="brand d-flex align-items-center gap-3">
          <img
            src="img/LOGO_PREFEITURADESAOPAULO_HORIZONTAL_MONOCROMATICO_PRETO_PT.png"
            alt="Prefeitura de São Paulo"
            class="logo"
          />
          <div class="brand-lines">
            <div class="kicker">Boletim Diário de Monitoramento</div>
            <h1 class="title m-0">Poda e Remoção de Árvores</h1>
            <div class="deck">
              Monitoramento do estoque operacional a partir de <strong>22/12/2025</strong>.
            </div>
          </div>
        </div>

        <aside class="edition-box">
          <div class="edition-top">
            <div class="edition-label">Edição</div>
            <div class="edition-value" id="edicaoNome">Diária</div>
          </div>

          <div class="edition-rule"></div>

          <div class="edition-meta">
            <div class="edition-meta-row">
              <span class="meta-k">Abrangência</span>
              <span class="meta-v">Município de São Paulo</span>
            </div>
            <div class="edition-meta-row">
              <span class="meta-k">Fonte</span>
              <span class="meta-v">Planilha operacional</span>
            </div>
          </div>

          <div class="pill-status" id="pillStatus">
            Para melhor visualização no celular, use a orientação horizontal.
          </div>
        </aside>
      </div>

      <div class="rule-thick mt-3"></div>
    </div>
  </header>

  <!-- LEAD -->
  <section class="leadline">
    <div class="container py-3">
      <div class="leadbox">
        <div class="lead-left">
          <div class="lead-tag">Sobre</div>
          <div class="lead-title" id="leadTitulo">
            Acompanhamento do estoque do serviço de Poda e Remoção de Árvores.
          </div>
          <p class="lead-text m-0">
            Este boletim consolida indicadores, tendências e consulta rápida à base diária para apoiar priorização e
            tomada de decisão e encerramento de solicitações de poda e remoção de árvores no município de São Paulo.
          </p>
        </div>

        <div class="lead-right">
          <div class="lead-brief">
            <div class="brief-label">Resumo do dia</div>
            <div class="brief-text brief-actions">
              <a class="btn btn-sm btn-dark" href="#indicadores">
                <i class="fa-solid fa-chart-line me-2"></i>Ver indicadores
              </a>
              <a class="btn btn-sm btn-outline-dark" href="#planilha">
                <i class="fa-solid fa-table me-2"></i>Abrir planilha
              </a>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- KPI SECTION -->
  <section class="kpi-section" id="indicadores">
    <div class="container pb-4">

      <div class="section-head">
        <h2 class="section-title m-0">Indicadores</h2>
        <div class="section-sub">Visão executiva consolidada</div>
      </div>

      <div class="rule-thin mt-2 mb-3"></div>

      <div class="row g-4 mt-1">

        <!-- KPIs topo -->
        <div class="col-12 col-md-4">
          <div class="kpi-card kpi-strong">
            <div class="kpi-top">
              <div class="kpi-label">Estoque total</div>
              <div class="kpi-icon"><i class="fa-solid fa-layer-group"></i></div>
            </div>
            <div class="kpi-value" id="kpiEstoqueTotal">—</div>
            <div class="kpi-foot">Total cadastrado na base</div>
          </div>
        </div>

        <div class="col-12 col-md-4">
          <div class="kpi-card">
            <div class="kpi-top">
              <div class="kpi-label">Abertas</div>
              <div class="kpi-icon"><i class="fa-solid fa-folder-open"></i></div>
            </div>
            <div class="kpi-value" id="kpiAbertas">—</div>
            <div class="kpi-foot">Solicitações abertas no período</div>
          </div>
        </div>

        <div class="col-12 col-md-4">
          <div class="kpi-card">
            <div class="kpi-top">
              <div class="kpi-label">Encerradas</div>
              <div class="kpi-icon"><i class="fa-solid fa-circle-check"></i></div>
            </div>
            <div class="kpi-value" id="kpiEncerradas">—</div>
            <div class="kpi-foot">Solicitações encerradas no período</div>
          </div>
        </div>

        <!-- Subprefeituras mais/menos -->
        <div class="col-12 col-xl-6">
          <div class="kpi-card kpi-warn">
            <div class="kpi-top">
              <div class="kpi-label">Subprefeituras que mais executaram no período</div>
              <div class="kpi-icon"><i class="fa-solid fa-trophy"></i></div>
            </div>
            <div class="kpi-list mt-3" id="cardsTopCumprida">—</div>
          </div>
        </div>

        <div class="col-12 col-xl-6">
          <div class="kpi-card kpi-danger">
            <div class="kpi-top">
              <div class="kpi-label">Subprefeituras que menos executaram no período</div>
              <div class="kpi-icon"><i class="fa-solid fa-circle-xmark"></i></div>
            </div>
            <div class="kpi-list mt-3" id="cardsFaltaMuito">—</div>
          </div>
        </div>

        <!-- Pizza -->
        <div class="col-12">
          <div class="kpi-card kpi-neutral">
            <div class="kpi-top">
              <div class="kpi-label">Distribuição de volume por Serviço/Tarefa (pizza)</div>
              <div class="kpi-icon"><i class="fa-solid fa-chart-pie"></i></div>
            </div>

            <div class="kpi-foot text-muted mt-2">
             Clique para ver os valores.
            </div>

            <div class="chart-wrap mt-3">
              <canvas id="servicosPie"></canvas>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- PLANILHA -->
  <section class="sheet-section py-4" id="planilha">
    <div class="container">

      <div class="section-head">
        <h2 class="section-title m-0">Planilha diária</h2>
        <div class="section-sub">Consulta rápida à base operacional</div>
      </div>

      <div class="rule-thin mt-2 mb-3"></div>

      <div class="panel">
        <div class="panel-head">
          <div>
            <div class="panel-title">Acesso rápido</div>
            <div class="panel-sub">Clique em “Ampliar” para abrir em tela cheia</div>
          </div>

          <button
            type="button"
            class="btn btn-sm btn-outline-dark"
            data-bs-toggle="modal"
            data-bs-target="#sheetModal"
            data-sheet-src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQU3Ui0t-ugrQp9BN2CeHWAXuIbhamE5KcrVQrJLiBfBUexSfspFiiTYQgAL_cSOQ/pubhtml?widget=true&headers=false">
            <i class="fa-solid fa-up-right-and-down-left-from-center me-2"></i>Ampliar
          </button>
        </div>

        <div class="sheet-crop">
          <iframe
            class="sheet-iframe"
            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQU3Ui0t-ugrQp9BN2CeHWAXuIbhamE5KcrVQrJLiBfBUexSfspFiiTYQgAL_cSOQ/pubhtml?widget=true&headers=false"
            loading="lazy"
            title="Planilha diária (Google Sheets)">
          </iframe>
        </div>
      </div>

    </div>
  </section>

  <!-- GRÁFICOS -->
  <section class="charts-section py-4" id="graficos">
    <div class="container">

      <div class="section-head">
        <h2 class="section-title m-0">Gráficos</h2>
        <div class="section-sub">Clique em “Ampliar” para abrir em nova aba</div>
      </div>

      <div class="rule-thin mt-2 mb-3"></div>

      <div class="row g-3">

        <div class="col-12">
          <div class="panel">
            <div class="panel-head">
              <div>
                <div class="panel-title">Evolução do estoque</div>
                <div class="panel-sub">Tendência do estoque consolidado</div>
              </div>

              <a class="btn btn-sm btn-outline-dark"
                 href="img/line_graph_20260127.png"
                 target="_blank"
                 rel="noopener">
                <i class="fa-solid fa-up-right-and-down-left-from-center me-2"></i>Ampliar
              </a>
            </div>

            <div class="chart-scroll">
              <div class="chart-stage">
                <div class="chart-media">
                  <img class="chart-img"
                       src="img/line_graph_20260127.png"
                       alt="Evolução do estoque"
                       loading="lazy" />
                </div>
              </div>
            </div>

          </div>
        </div>

        <div class="col-12">
          <div class="panel">
            <div class="panel-head">
              <div>
                <div class="panel-title">Estoque por Subprefeitura</div>
                <div class="panel-sub">Distribuição do estoque atual por território</div>
              </div>

              <a class="btn btn-sm btn-outline-dark"
                 href="img/bar_graph_20260127.png"
                 target="_blank"
                 rel="noopener">
                <i class="fa-solid fa-up-right-and-down-left-from-center me-2"></i>Ampliar
              </a>
            </div>

            <div class="chart-scroll">
              <div class="chart-stage">
                <div class="chart-media">
                  <img class="chart-img"
                       src="img/bar_graph_20260127.png"
                       alt="Estoque por Subprefeitura"
                       loading="lazy" />
                </div>
              </div>
            </div>

          </div>
        </div>

      </div>

      <!-- Footer -->
      <footer class="footer mt-4">
        <div class="footer-grid">
          <div>
            <div class="footer-title">Secretaria Municipal das Subprefeituras</div>
            <div class="footer-sub">© <span id="ano"></span> • COPLAN/Dados</div>
          </div>
          <div class="footer-sub text-md-end">
            Documento interno para acompanhamento gerencial.
          </div>
        </div>
      </footer>

    </div>
  </section>

  <!-- MODAL: PLANILHA (APENAS 1x) -->
  <div class="modal fade" id="sheetModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
      <div class="modal-content">

        <div class="modal-header modal-header-fix">
          <h5 class="modal-title text-truncate">Planilha Expandida</h5>
          <button type="button"
                  class="btn btn-sm btn-outline-light modal-close-fix"
                  data-bs-dismiss="modal"
                  aria-label="Fechar">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>

        <div class="modal-body p-0">
          <iframe id="modalSheetIframe"
                  class="modal-sheet-iframe"
                  title="Planilha expandida"></iframe>
        </div>

      </div>
    </div>
  </div>

  <!-- BOTÃO VOLTAR AO TOPO -->
  <a href="#topo" class="back-to-top" aria-label="Voltar ao início" title="Voltar ao início">
    <i class="fa-solid fa-arrow-up"></i>
  </a>

  <!-- Bootstrap bundle JS (necessário pro modal funcionar) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Back-to-top -->
  <script>
    const btnTop = document.querySelector(".back-to-top");
    if (btnTop) {
      const toggleBtn = () => {
        if (window.scrollY > 250) btnTop.classList.add("show");
        else btnTop.classList.remove("show");
      };
      toggleBtn();
      window.addEventListener("scroll", toggleBtn, { passive: true });
    }
  </script>

</body>
</html>
